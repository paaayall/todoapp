<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Todo</title>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --muted:#94a3b8;       /* slate-400 */
      --text:#e5e7eb;        /* gray-200 */
      --accent:#22c55e;      /* green-500 */
      --accent-2:#3b82f6;    /* blue-500 */
      --danger:#ef4444;      /* red-500 */
      --ring:#334155;        /* slate-600 */
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:linear-gradient(120deg, #0b1225, #151a2b 30%, #0b1225);
      color:var(--text);
      min-height:100svh; display:grid; place-items:center; padding:32px;
    }
    .app{
      width:min(720px, 92vw);
    }
    .card{
      background:var(--panel); border:1px solid #1f2937; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.25);
      overflow:hidden;
    }
    header{
      padding:24px; border-bottom:1px solid #1f2937;
      display:flex; align-items:center; gap:12px; flex-wrap:wrap;
    }
    h1{font-size:1.3rem; margin:0; letter-spacing:.3px}
    .new-todo{
      display:flex; gap:10px; width:100%;
    }
    input[type="text"]{
      flex:1; background:#0b1220; color:var(--text); border:1px solid var(--ring); border-radius:12px; padding:12px 14px; font-size:1rem;
      outline:none; box-shadow:none; transition:border .15s ease;
    }
    input[type="text"]:focus{border-color:var(--accent-2)}
    button{
      border:0; background:var(--accent-2); color:white; padding:12px 14px; border-radius:12px; font-weight:600; cursor:pointer;
    }
    button[disabled]{opacity:.6; cursor:not-allowed}
    ul{
      list-style:none; margin:0; padding:0;
    }
    .empty{
      padding:28px; text-align:center; color:var(--muted); border-top:1px dashed #1f2937;
    }
    .todo{
      display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:12px;
      padding:14px 18px; border-top:1px solid #1f2937; background:transparent;
    }
    .todo:hover{background:#0b1220}
    .todo input[type="checkbox"]{width:18px; height:18px}
    .title{line-height:1.4}
    .completed .title{ color:var(--muted); text-decoration:line-through; }
    .actions{display:flex; align-items:center; gap:8px}
    .icon-btn{background:#0b1220; padding:8px 10px; border-radius:10px; border:1px solid #1f2937}
    .icon-btn.delete{background:#1a1111; border-color:#3b1f1f; color:#fecaca}

    footer{
      border-top:1px solid #1f2937; padding:14px 18px; display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:space-between; color:var(--muted);
    }
    .filters{display:flex; gap:8px}
    .chip{
      background:#0b1220; border:1px solid #1f2937; color:var(--text); padding:8px 10px; border-radius:999px; cursor:pointer;
    }
    .chip.active{border-color:var(--accent); box-shadow:0 0 0 2px #0b1220, 0 0 0 4px rgba(34,197,94,.35)}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0}

    .edit-input{ width:100%; background:#0b1220; color:var(--text); border:1px solid var(--ring); border-radius:8px; padding:8px 10px; font-size:1rem; }
  </style>
</head>
<body>
  <main class="app">
    <div class="card" role="application" aria-label="Todo app">
      <header>
        <h1>üìù Todo</h1>
        <form class="new-todo" id="form" autocomplete="off">
          <label for="todo-input" class="sr-only">Add a task</label>
          <input id="todo-input" type="text" placeholder="Add a task and press Enter‚Ä¶" maxlength="120" />
          <button id="add-btn" type="submit">Add</button>
        </form>
      </header>

      <ul id="list" aria-live="polite"></ul>
      <div id="empty" class="empty" hidden>Nothing here yet. Add your first task! ‚ú®</div>

      <footer>
        <div id="count">0 items</div>
        <div class="filters" role="tablist" aria-label="Filter tasks">
          <button class="chip" data-filter="all" aria-selected="true">All</button>
          <button class="chip" data-filter="active">Active</button>
          <button class="chip" data-filter="completed">Completed</button>
        </div>
        <button id="clear" class="chip">Clear completed</button>
      </footer>
    </div>
  </main>

  <template id="todo-template">
    <li class="todo">
      <input class="toggle" type="checkbox" aria-label="Toggle complete" />
      <div class="title" tabindex="0"></div>
      <div class="actions">
        <button class="icon-btn edit" title="Edit">‚úèÔ∏è</button>
        <button class="icon-btn delete" title="Delete">üóëÔ∏è</button>
      </div>
    </li>
  </template>

  <script>
    // --- State ---
    const STORAGE_KEY = 'vanilla_todos_v1';
    let todos = load();
    let currentFilter = 'all';

    function load(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }catch{ return []; }
    }
    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)); }

    // --- DOM ---
    const form = document.getElementById('form');
    const input = document.getElementById('todo-input');
    const list = document.getElementById('list');
    const empty = document.getElementById('empty');
    const count = document.getElementById('count');
    const clearBtn = document.getElementById('clear');
    const chips = Array.from(document.querySelectorAll('.chip[data-filter]'));

    // --- Helpers ---
    const uid = () => crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2);

    function addTodo(text){
      const t = text.trim();
      if(!t) return;
      todos.push({ id: uid(), text: t, completed: false });
      save();
      render();
    }

    function deleteTodo(id){
      todos = todos.filter(t => t.id !== id);
      save();
      render();
    }

    function toggleTodo(id){
      todos = todos.map(t => t.id === id ? { ...t, completed: !t.completed } : t);
      save();
      render();
    }

    function updateTodo(id, newText){
      const text = newText.trim();
      if(!text){ deleteTodo(id); return; }
      todos = todos.map(t => t.id === id ? { ...t, text } : t);
      save();
      render();
    }

    function clearCompleted(){
      todos = todos.filter(t => !t.completed);
      save();
      render();
    }

    function setFilter(f){
      currentFilter = f; // 'all' | 'active' | 'completed'
      chips.forEach(c => {
        c.classList.toggle('active', c.dataset.filter === f);
        c.setAttribute('aria-selected', c.dataset.filter === f ? 'true' : 'false');
      });
      render();
    }

    function visibleTodos(){
      switch(currentFilter){
        case 'active': return todos.filter(t => !t.completed);
        case 'completed': return todos.filter(t => t.completed);
        default: return todos;
      }
    }

    function render(){
      const data = visibleTodos();
      list.innerHTML = '';
      empty.hidden = data.length !== 0;

      data.forEach(t => {
        const tpl = document.getElementById('todo-template').content.cloneNode(true);
        const li = tpl.querySelector('li');
        li.dataset.id = t.id;
        if(t.completed) li.classList.add('completed');

        const checkbox = tpl.querySelector('.toggle');
        checkbox.checked = t.completed;
        checkbox.addEventListener('change', () => toggleTodo(t.id));

        const title = tpl.querySelector('.title');
        title.textContent = t.text;

        // enable keyboard toggle with Space when focused on title
        title.addEventListener('keydown', (e)=>{
          if(e.code === 'Space') { e.preventDefault(); toggleTodo(t.id); }
        });

        const delBtn = tpl.querySelector('.delete');
        delBtn.addEventListener('click', () => deleteTodo(t.id));

        const editBtn = tpl.querySelector('.edit');
        editBtn.addEventListener('click', () => beginEdit(li, t));

        list.appendChild(tpl);
      });

      const remaining = todos.filter(t => !t.completed).length;
      count.textContent = `${remaining} item${remaining!==1?'s':''} left`;
    }

    function beginEdit(li, todo){
      const titleDiv = li.querySelector('.title');
      const current = titleDiv.textContent;
      const input = document.createElement('input');
      input.className = 'edit-input';
      input.value = current;
      titleDiv.replaceWith(input);
      input.focus();
      input.setSelectionRange(current.length, current.length);

      const finish = (commit) => {
        input.removeEventListener('blur', onBlur);
        input.removeEventListener('keydown', onKey);
        const newVal = commit ? input.value : current;
        updateTodo(todo.id, newVal);
      };
      const onBlur = () => finish(true);
      const onKey = (e) => {
        if(e.key === 'Enter') finish(true);
        else if(e.key === 'Escape') finish(false);
      };
      input.addEventListener('blur', onBlur);
      input.addEventListener('keydown', onKey);
    }

    // --- Events ---
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      addTodo(input.value);
      input.value='';
      input.focus();
    });

    clearBtn.addEventListener('click', clearCompleted);

    chips.forEach(chip => chip.addEventListener('click', ()=> setFilter(chip.dataset.filter)));

    // Keyboard shortcuts
    document.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='k'){
        e.preventDefault();
        input.focus();
      }
    });

    // --- Init ---
    render();
  </script>
</body>
</html>
